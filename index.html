<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>DontStarveLuaJIT by paintdream</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">DontStarveLuaJIT</h1>
      <h2 class="project-tagline">LuaJIT for DontStarve (compatible with DS, RoG, SW, DST)</h2>
      <a href="https://github.com/paintdream/DontStarveLuaJIT" class="btn">View on GitHub</a>
      <a href="https://github.com/paintdream/DontStarveLuaJIT/releases" class="btn">Download Binary 下载发行包</a>
      <a href="https://github.com/paintdream/DontStarveLuaJIT/tarball/master" class="btn">Download Source 下载源码包</a>
    </section>

    <section class="main-content">
      <h1>DontStarveLuaJIT</h1>
<pre><code>LuaJIT for DontStarve (compatible with DS, RoG, SW, DST for Windows, Dedicated Server for Linux)
</code></pre>
<h4>PLEASE BACKUP YOUR SAVES BEFORE APPLYING THIS PATCH.</h4>
<h4>在启用这个补丁之前，请务必备份你的所有存档。</h4>
<p>All technique detils available at: <a href="https://zhuanlan.zhihu.com/p/24570361" rel="nofollow">https://zhuanlan.zhihu.com/p/24570361</a> (Chinese only).</p>
<p>我把<a href="https://zhuanlan.zhihu.com/p/24570361" rel="nofollow">本文所有技术细节、原理</a>发在了知乎专栏上，如果对项目有疑问可以先看看文章。</p>
<hr>
<h2>Installation（安装）:</h2>
<h3>Windows</h3>
<pre><code>Copy all files from folder "win" to "[Your Don't Starve [Together] Directory]/bin/"

	Copy all files from folder "win" to "[Your Don't Starve [Together] Directory]/bin/"
	复制发布包"win"目录下的所有文件至"[您的Don't Starve [Together] 安装目录]/bin/"
	
	Launch the game, press ` and type:
	启动游戏，按`打开控制台，输入：
	
	print(_VERSION)
	
	And you can see message started with "LuaJIT".
	你可以看到LuaJIT字样的输出，这就说明已经安装成功。

	If you want uninstall this patch, just remove these copied files (i.e. WINMM.DLL, lua51.dll, lua51DS.dll) from the bin folder.
	如果需要卸载本Patch，只需要删掉您这些新复制的文件（WINMM.DLL, lua51.DLL, lua51DS.dll）即可。
  
</code></pre>
<h3>Linux</h3>
	It's highly recommended to compile the release yourself. See the section 'Compilation' below.
	强烈建议自行编译linux版本，具体操作方式请看下文“编译”一节。

	Copy all files from folder "linux" to "[Your Don't Starve [Together] Directory]/bin/lib32/", start game with the following environment setting:
	复制发布包"linux"目录下的所有文件至"[您的Don't Starve [Together] 安装目录]/bin/lib32"，使用如下环境参数启动游戏：
	
	export LD_PRELOAD=libpreload.so

	NOTICE: libpreload.so/liblua51.so/liblua51DS.so may rely on some C-runtime libraries, which are not present on your computer.
	Try to use ldd to find dependencies and install them.
	注意，由于Linux平台的特殊性，发行包中提供的libpreload.so、liblua51.so、liblua51DS.so可能无法直接在您的计算机上执行。
	如果您遇到安装失败，则一般是由于liblua51DS.so的依赖没有安装导致的。您可以使用ldd命令来查看缺少哪些依赖并安装它们，比如：

	ldd liblua51DS.so
	
	For example, if 'readline' was reported missing, then you could have it installed by following instructions(Debian/Ubuntu):
	比如提示readline找不到，那么就使用如下命令安装(Debian/Ubuntu)：
	
	sudo apt-get install lib32readline6
	
	If your system are suggrested to install newer version of lib32realine, e.g. lib32readline8. Making a soft link of it to could work.
	如果您的系统比较新（如Debian buster），可能只能安装高版本的lib32readline8，您可以制作一个软链接到lib32readline6来使用。
	
	ln -s /lib32/libreadline.so.8 /lib32/libreadline.so.6

	For dedicated server, that's enough. But it's not work with the game client, since the game requests steam to restart it if it was not started by steam.
	As a result, LD_PRELOAD will be missing when steam starts it. Here's a workaround from hyiltiz that works:
	对于独立服务器而言，上面的步骤做完后就可以启动服务器了。但是客户端并不行，这是因为客户端会请求steam去启动它。
	这样二次启动后LD_PRELOAD参数就无效了，您可以通过以下的方案绕过它：

	Rename dontstarve to dontstarve.bin:
	将dontstarve程序重命名为dontstarve.bin:

	mv dontstarve dontstarve.bin

	Write a new bash with following content:
	编写一个新的脚本，内容如下，命名为dontstarve：
	
	#!/bin/sh
	LD_PRELOAD=./lib32/libpreload.so ./dontstarve_steam.bin

	Add executable access:
	加入执行权限：

	chmod +x dontstarve_steam

	Then enjoy your game!
	接着就可以运行游戏了！
</code></pre>
<h2>Compilation（编译）:</h2>
<pre><code>The following part is for developers only.

**普通玩家止步。这部分内容是给开发者看的。**
</code></pre>
<h3>Windows</h3>
<pre><code>For Windows version, the project 'lua51' in solution must be compiled with MSVC9 (Visual Studio 2008) to generate 
binary-compatible code for dontstarve_steam.exe. To compile luajit, please launch Visual C++ 
Build Prompt and run msvcbuild.bat.

对于Windows版本，为确保与饥荒主程序的二进制兼容性，解决方案中的lua51必须使用MSVC9（即VS2008）来编译。

如果您要自行编译luajit，请在Visual C++的控制台中运行luajit目录下的msvcbuild.bat。
</code></pre>
<h3>Linux</h3>
<pre><code>For linux version, the project 'lua51' must be compiled with GCC 4.8.4:i386, which is builtin compiler tool of Ubuntu 14.04 LTS.

对于Linux版本，lua51工程需要使用GCC 4.8.4:i386编译。您可以安装Ubuntu 14.04 LTS版本，使用自带的GCC即可。
</code></pre>
<h2>Acknowledgements（致谢）:</h2>
<pre><code>Great thanks to the following players for testing and suggestions!

感谢以下网友对于MOD的测试和建议！

	风雨凌芸、子恒Clark、359368170、lild100、kkrbdsgc、__PeakChen、o裙下臣o、 LC_1992、
	pikry、沉睡森丶林、可待year、绝世鱼人、王太太平、力玄破、渊_雎、风雪归途、幻想草莓梦、
	sharpwind95、乔碧萝、辣椒小皇纸、☆风铃草☆、hyiltiz 
  
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/paintdream/DontStarveLuaJIT">Dontstarveluajit</a> is maintained by <a href="https://github.com/paintdream">paintdream</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
